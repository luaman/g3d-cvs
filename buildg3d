#!/usr/bin/env python
# -*- python -*-

from buildlib import *

##################################################################################
#  CMake targets
 
def clib(args):
     mkdir ("./build")
     mkdir ("./build/release")
     os.chdir ("build/release")
     if (1):
         print ("Changed directory to: " + os.getcwd())
         run("cmake", ["../../", "-DCMAKE_BUILD_TYPE:STRING=Release"])
         run("make", [])
     else:
         print ("Unable to change directories to:\n\t" + os.getcwd() + "/build/release")

def cclean(args):
     rmdir ("build")

def ctest(args):
     print "Target Unimplemented"

##################################################################################
#  iCompile targets

def ilib(args):
     os.chdir("G3D.lib")
     run("../bin/icompile")
     run("../bin/icompile", ['-O'])

     os.chdir("../GLG3D.lib")
     run("../bin/icompile")
     run("../bin/icompile", ['-O'])
     os.chdir("..")

def iclean(args):
     os.chdir("G3D.lib")
     run("../bin/icompile", ['--clean'])

     os.chdir("../GLG3D.lib")
     run("../bin/icompile", ['--clean'])

     os.chdir("../test.lib")
     run("../bin/icompile", ['--clean'])
     os.chdir("..")

def itest(args):
     os.chdir("test")
     run("../bin/icompile")
     os.chdir("..")


##################################################################################
#  General
        
def buildHelp():
    print """
build - Automated build system for graphics3D.

Syntax: 
    build target [install-dir]

TARGET         DESCRIPTION

help       Display this message

Targets using CMake:
clib       Build G3D, G3Dd, GLG3D, GLG3Dd and copy over headers
debug      Build G3D, G3Dd, GLG3D, GLG3Dd using debug information
ctest      Build test and testd and then run both
cclean     Remove all files generated by CMake/make
fastlib    Builds link libraries without using CMake

Targets using iCompile:
ilib       Build G3D, G3Dd, GLG3D, GLG3Dd and copy over headers
itest      Build test and testd and then run both
iclean     Remove all files generated by iCompile

See cpp/readme.html for detailed build information.
"""

dispatchOnTarget(
  [clib, cclean, ctest,
   ilib, iclean, itest], buildHelp)
